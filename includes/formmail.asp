<%    ':::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   '::                                                                   ::   '::   SCRIPT:    FORMMAIL.ASP                                         ::   '::   AUTHOR:    Mike Shaffer (mshaffer@masterlink.com)               ::   '::   DATE:      20-June-2002                                         ::   '::   REVISED:   30-Sep-2005                                          ::   '::   PURPOSE:   Sends an email with all form elements delineated     ::   '::                                                                   ::   '::  COPYRIGHT *c* 2002, Mike Shaffer, ALL RIGHTS RESERVED WORLDWIDE  ::   '::                                                                   ::   ':::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   ' Instructions for use:  Modify the following fields:   '   '   mailfrom   '   mailto   '   ' You may also alter the mailsubject and thanksredirect here, however -   ' if the dd_mailsubject and/or dd_thanksredirect variables are defined    ' in the form being submitted, those values will take precedence   '   mailfrom = request.Form ("email")   mailto = "zak@imaginary-paper.com"   mailsubject = "imaginarypaper Contact Form"   ' Fill in the thanksredirect with the full URL where the use should be   ' sent once the data has been sent   thanksredirect = "thanks.asp"               ':::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   ':: No need to change anything below this line! (so DON'T!)           ::   ':::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::      '::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   '::  This function returns form fields in proper order                     ::   '::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   Function strGetFormNames()      dim strFormNames()      dim strFormFields      dim intCounter      dim strField      dim intFieldIndex      dim blnFieldFound      dim strCurrentField      strFormFields = split(request.form,"&")      intCounter = 0      for each strField in strFormFields         blnFieldFound = false         strCurrentField = replace(trim(left(strField, instr(strField,"=")-1)),"+"," ")         if instr(strCurrentField,"%") > 0 then            for bytCharVal = 0 to 15               strCurrentField = Replace(strCurrentField,"%0" & hex(bytCharVal),chr(bytCharVal))            next            for bytCharVal = 16 to 255               strCurrentField = Replace(strCurrentField,"%" & hex(bytCharVal),chr(bytCharVal))            next         end if         '         if intCounter > 0 then            for intFieldIndex = 0 to intCounter-1               if lcase(strCurrentField) = lcase(strFormNames(intFieldIndex)) then                  blnFieldFound = true                  exit for               end if            next         end if         '         if not blnFieldFound and strCurrentField > "" then            redim preserve strFormNames(intCounter)            strFormNames(intCounter) = strCurrentField            intCOunter = intCounter + 1         end if      next      '      strGetFormNames = strFormNames      '   end function      '::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   '::  function to make strings safe                                         ::   '::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   private function strSquoze(byVal strTemp)         dim intX      ' Change CR/LF to space      strTemp = replace(strTemp, vbCRLF, " ")            ' Filter any 'extended' characters      for intX = 128 to 255         if instr(strTemp, chr(intX)) then            strTemp = replace(strTemp, chr(intX), " ")         end if      next               strSquoze = trim(strTemp)            end function   function sqlPrep(strTemp, intLen)      dim strTemp2      strTemp2 = trim(left(strTemp & space(intLen), intLen))      sqlPrep = "'" & replace(strTemp2, "'", "''") & "'"   end function   '::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   ':::  Send an email                                             :::   '::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   function SendMail(strMailFrom, strMailTo, strSubject, strMessage)       dim MailObj       set mailObj = Server.CreateObject("CDONTS.NewMail")       mailObj.BodyFormat = 0       mailObj.MailFormat = 0       mailObj.From = strMailFrom       mailObj.To = strMailTo       mailObj.Subject = strSubject       mailObj.Body = strMessage       mailObj.Send	   set MailObj = nothing   end function   '::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   '::  M A I N L I N E    C O D E    H E R E                                 ::   '::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::   ' First, build the message body (all fields + values)   strBuffer = "<table border=""1"" cellpadding=""4"" cellspacing=""0"" style=""border-collapse: collapse;"">"   for each objField in strGetFormNames      if ucase(objField) <> "FIELDNAMES" AND lcase(left(objField,3)) <> "dd_" and lcase(left(objField,1)) <> "x" AND ucase(objField) <> "SUBMIT" then         strBuffer = strBuffer & "<tr valign=""top""><td bgcolor=""#FFFFCC"">" & trim(objField) & "</td><td>" & strSquoze(request.form(objField)) & "</td></tr>"      end if   next   stBuffer = strBuffer & "</table>"      strBuffer2 = "An interest form has been filled out on " & datevalue(now) & " at " & timevalue(now) & ".<br><br>"   strBuffer2 = strBuffer2 & "The information entered by the user follows:<br><blockquote>"   strBuffer = strBuffer2 & strBuffer & "</blockquote><br>"   if len(request.form("dd_mailsubject")) > 0 then      strSubject = request.form("dd_mailsubject")   elseif len(mailsubject) > 0 then      strSubject = mailsubject   end if   SendMail MailFrom, MailTo, strSubject, strBuffer   if len(request.form("dd_thanksredirect field")) > 0 then      response.redirect request.form("dd_thanksredirect")   elseif len(thanksredirect) > 0 then      response.redirect thanksredirect   end if   ' If no redirect, issue a generic response   response.write "<html><body><br><br><br><br>Thank you for your interest. Your message has been sent.<br><br><br><br></body></html>"%>